<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Discompress — 10MB Video</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root { --bg:#0b0b12; --card:#141422; --text:#e9f0ff; --acc1:#27f1ff; --acc2:#ff4df0; }
  * { box-sizing: border-box; }
  body { margin:0; min-height:100vh; display:grid; place-items:center;
    background: radial-gradient(1200px 600px at 80% -10%, #1a1a30 0%, transparent 60%),
                radial-gradient(900px 500px at -10% 110%, #17172a 0%, transparent 60%),
                var(--bg);
    color:var(--text); font:500 16px/1.4 system-ui,Segoe UI,Roboto,Inter; }
  .shell { width:min(680px,92vw); padding:2px; border-radius:22px;
    background:linear-gradient(135deg,var(--acc1),var(--acc2)); filter:drop-shadow(0 10px 40px rgba(0,0,0,.35)); }
  .card { padding:36px; border-radius:20px; background:var(--card); }
  h1{margin:0 0 10px; font-size:28px} p{margin:0 0 18px; opacity:.8}
  .drop{ margin:16px 0 18px; padding:36px; border:2px dashed #2a2a46; border-radius:16px;
    display:grid; place-items:center; text-align:center; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.1)); }
  .btn{ display:inline-block; padding:12px 18px; border-radius:12px; cursor:pointer;
    background:linear-gradient(135deg,var(--acc1),var(--acc2)); color:#0a0a12; font-weight:700; letter-spacing:.4px; border:none; }
  .bar{ width:100%; height:10px; background:#1e1e33; border-radius:999px; overflow:hidden; margin:14px 0 6px; }
  .fill{ width:0%; height:100%; background:linear-gradient(90deg,var(--acc1),var(--acc2)); transition:width .1s linear; }
  .hint{ font-size:12px; opacity:.6; }
</style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <h1>Discompress</h1>
      <p>Upload a video. We’ll send it back under <b>10&nbsp;MB</b>.</p>

      <div class="drop">
        <div>
          <div style="margin-bottom:10px;">Drag & drop a file here</div>
          <button id="pick" class="btn">Choose a file</button>
          <input id="file" type="file" accept="video/*" style="display:none">
        </div>
      </div>

      <div class="bar"><div id="fill" class="fill"></div></div>
      <div class="hint" id="status">Idle</div>
    </div>
  </div>

<script>
  // AFTER you deploy on Render, replace <RENDER_URL> with your real URL like:
  // const API = 'https://discompress.onrender.com/api/upload';
  const API = '<RENDER_URL>/api/upload';

  const pick = document.getElementById('pick');
  const fileInput = document.getElementById('file');
  const fill = document.getElementById('fill');
  const statusEl = document.getElementById('status');

  pick.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', ()=> {
    if (fileInput.files && fileInput.files[0]) uploadFile(fileInput.files[0]);
  });

  function setStatus(t){ statusEl.textContent = t; }
  function setProgress(p){ fill.style.width = Math.max(0, Math.min(100, p)) + '%'; }

  function uploadFile(file){
    setStatus('Uploading…');
    setProgress(5);
    const form = new FormData();
    form.append('video', file);

    const xhr = new XMLHttpRequest();
    xhr.open('POST', API, true);
    xhr.responseType = 'blob';

    xhr.upload.onprogress = (e) => {
      if (e.lengthComputable) {
        const p = (e.loaded / e.total) * 100;
        setProgress(Math.round(p * 0.8));
        setStatus(`Uploading… ${Math.round(p)}%`);
      }
    };

    xhr.onreadystatechange = () => {
      if (xhr.readyState === 2) setStatus('Processing…');
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          setProgress(100);
          setStatus('Downloading…');
          const blob = xhr.response;
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'discompress_video.mp4';
          a.click();
          URL.revokeObjectURL(url);
          setStatus('Done ✅');
        } else {
          setStatus('Failed. Try a shorter clip.');
        }
      }
    };
    xhr.send(form);
  }
</script>
</body>
</html>
