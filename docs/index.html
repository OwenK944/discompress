<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Discompress â€” Under 10MB for Discord</title>
<meta name="description" content="Upload a video. Get it back under 10MB. One button.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0b12; --text:#eaf2ff; --muted:#a1a8bd;
    --a:#27f1ff; --b:#ff4df0;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font:500 16px/1.5 "Sora",system-ui,Segoe UI,Inter,Roboto;
    background:
      radial-gradient(1200px 700px at 92% -10%, #1b1b33 0%, transparent 60%),
      radial-gradient(900px 600px at -10% 110%, #17172c 0%, transparent 60%),
      conic-gradient(from 0deg at 60% 40%, #12122a, #0e1020, #17112a, #0e1020, #12122a);
    animation:bgShift 18s linear infinite;
    display:grid; place-items:center; padding:40px;
  }
  @keyframes bgShift{0%{background-position:0 0,0 0,0 0}50%{background-position:8% -6%,-6% 10%,120px 60px}100%{background-position:0 0,0 0,0 0}}
  .wrap{max-width:900px; text-align:center; width:min(92vw,900px)}
  h1{margin:0 0 10px; font-weight:800; font-size:clamp(28px,5vw,44px); letter-spacing:.2px; text-shadow:0 2px 20px #0007}
  .sub{margin:0 auto 28px; color:var(--muted); max-width:640px; font-size:clamp(14px,2.6vw,18px)}

  /* === The ONE big button: glass + neon + hover/click === */
  #pick{
    position:relative; display:inline-block; border:0; cursor:pointer; user-select:none;
    padding:clamp(16px,3.5vw,28px) clamp(26px,6vw,60px);
    border-radius:22px; font-weight:800; font-size:clamp(16px,3.8vw,24px); letter-spacing:.4px;
    color:#eef6ff; background:transparent; isolation:isolate; transform:translateZ(0);
    transition:transform .15s ease, filter .3s ease, box-shadow .3s ease;
  }
  #pick:active{ transform:translateY(2px) scale(.98) }
  #pick::before{
    content:""; position:absolute; inset:0; border-radius:22px; padding:3px;
    background:linear-gradient(135deg,var(--a),var(--b));
    -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
    -webkit-mask-composite:xor; mask-composite:exclude; z-index:-1;
    filter:drop-shadow(0 0 38px rgba(39,241,255,.35)) drop-shadow(0 0 34px rgba(255,77,240,.28));
  }
  #pick::after{
    content:""; position:absolute; inset:5px; border-radius:17px;
    background:
      linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.03)),
      radial-gradient(120% 200% at 0% 0%, rgba(39,241,255,.28), transparent 60%),
      radial-gradient(120% 200% at 100% 100%, rgba(255,77,240,.28), transparent 60%),
      #131433dd;
    backdrop-filter: blur(10px);
    z-index:-1;
  }
  #pick:hover{ filter:drop-shadow(0 0 40px rgba(39,241,255,.4)) drop-shadow(0 0 40px rgba(255,77,240,.3)) }
  #pick .shine{pointer-events:none; position:absolute; inset:5px; border-radius:17px; overflow:hidden}
  #pick .shine::before{content:""; position:absolute; top:0; left:-150%; width:40%; height:100%;
    background:linear-gradient(90deg,transparent,rgba(255,255,255,.33),transparent); transform:skewX(-20deg)}
  #pick:hover .shine::before{ animation:shine 1.1s ease }
  @keyframes shine{0%{left:-150%}100%{left:150%}}

  /* Progress bar (hidden until needed) */
  .progress{ width:min(720px,92vw); height:12px; margin:18px auto 0; background:#1e2035; border-radius:999px; overflow:hidden;
    opacity:0; transform:translateY(8px); transition:opacity .35s ease, transform .35s ease; pointer-events:none }
  .progress.show{ opacity:1; transform:translateY(0) }
  .fill{ width:0%; height:100%; background:linear-gradient(90deg,var(--a),var(--b)); transition:width .09s linear }

  /* Hidden input */
  #file{display:none}
  /* Mobile spacing */
  @media (max-width:520px){ .wrap{padding:0 4px} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Discompress</h1>
    <p class="sub">Upload a video. Get it back under <b>10&nbsp;MB</b>. One button.</p>

    <input id="file" type="file" accept="video/*">
    <button id="pick">Upload Video<span class="shine" aria-hidden="true"></span></button>

    <div id="progress" class="progress" aria-hidden="true"><div id="fill" class="fill"></div></div>
  </div>

<script>
  // ðŸ”— BACKEND (Render)
  const RENDER_URL = 'https://discompress.onrender.com'; // change if yours differs
  const API = RENDER_URL + '/api/upload';
  const HEALTH = RENDER_URL + '/health';

  const pick = document.getElementById('pick');
  const file = document.getElementById('file');
  const progress = document.getElementById('progress');
  const fill = document.getElementById('fill');

  // Debug overlay (Ctrl + D)
  const dbg = (()=>{
    const box = document.createElement('pre');
    box.style.cssText = 'position:fixed;bottom:14px;left:14px;max-width:min(92vw,680px);max-height:46vh;overflow:auto;margin:0;' +
      'padding:10px 12px;background:#0b0b12e6;border:1px solid #232343;border-radius:10px;color:#cfe3ff;font:12px/1.35 ui-monospace,Consolas,Menlo;' +
      'box-shadow:0 8px 30px rgba(0,0,0,.4);display:none;white-space:pre-wrap;';
    document.body.appendChild(box);
    function log(...a){ box.textContent += a.join(' ') + '\n'; box.scrollTop = box.scrollHeight; }
    function toggle(){ box.style.display = (box.style.display==='none'?'block':'none'); }
    window.addEventListener('keydown', (e)=>{ if(e.ctrlKey && (e.key==='d' || e.key==='D')) { e.preventDefault(); toggle(); } });
    return {log,toggle};
  })();

  // quick health check
  fetch(HEALTH).then(r=>dbg.log('health:', r.status)).catch(e=>dbg.log('health error:', e.message));

  pick.addEventListener('click', ()=> file.click());
  file.addEventListener('change', ()=>{
    const f = file.files && file.files[0];
    if (f) upload(f);
  });

  function showProgress(show){ progress.classList.toggle('show', !!show); }
  function setProgress(p){ fill.style.width = Math.max(0, Math.min(100, p)) + '%'; }

  function upload(f){
    // reset
    setProgress(0); showProgress(true);
    pick.disabled = true; pick.style.opacity = .85;

    const form = new FormData(); form.append('video', f);
    const xhr = new XMLHttpRequest();
    xhr.open('POST', API, true);
    xhr.responseType = 'blob';

    // upload â†’ 0..80
    xhr.upload.onprogress = (e)=>{
      if (!e.lengthComputable) return;
      const up = (e.loaded / e.total) * 80;
      setProgress(Math.round(up));
    };

    let procTimer = null;
    xhr.onreadystatechange = ()=>{
      if (xhr.readyState === 2){ // headers => server processing
        dbg.log('server accepted; processingâ€¦');
        let p = Math.max(parseInt(fill.style.width) || 80, 80);
        clearInterval(procTimer);
        procTimer = setInterval(()=>{ if (p < 99) { p += 0.25; setProgress(p); } }, 120);
      }
      if (xhr.readyState === 4){
        clearInterval(procTimer);
        dbg.log('done state:', xhr.status);
        if (xhr.status === 200){
          setProgress(100);
          const blob = xhr.response;
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'discompress_video.mp4'; a.click();
          URL.revokeObjectURL(url);
          setTimeout(()=>{ showProgress(false); setProgress(0); }, 700);
        } else {
          // show error briefly in debug + flash bar red
          const reader = new FileReader();
          reader.onload = ()=> dbg.log('error body:', reader.result || '(no text)');
          try { reader.readAsText(xhr.response); } catch(_) {}
          fill.style.transition = 'none'; fill.style.width = '100%'; fill.style.background = '#ff5c80';
          setTimeout(()=>{ fill.style.transition='width .09s linear'; fill.style.background='linear-gradient(90deg,var(--a),var(--b))';
            showProgress(false); setProgress(0); }, 1100);
        }
        pick.disabled = false; pick.style.opacity = 1; file.value='';
      }
    };
    xhr.onerror = ()=>{ dbg.log('network error'); showProgress(false); setProgress(0); pick.disabled=false; pick.style.opacity=1; file.value=''; };
    xhr.send(form);
  }
</script>
</body>
</html>
